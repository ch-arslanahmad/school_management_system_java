# Database Queries

**For testing**
```
CREATE TABLE Class (
  ClassID INTEGER PRIMARY KEY AUTOINCREMENT,
  ClassName TEXT
);

CREATE TABLE Subjects (
  SubjectID INTEGER PRIMARY KEY AUTOINCREMENT,
  SubjectName TEXT,
  ClassID TEXT,
FOREIGN KEY (ClassID) REFERENCES Class(ClassID)

CREATE TABLE Student (
  StudentID INTEGER PRIMARY KEY AUTOINCREMENT,
  StudentName TEXT,
  ClassID INTEGER,
  FOREIGN KEY (ClassID) REFERENCES Class(ClassID)
);
```
---

Inserting Columns in Tables
```
CREATE TABLE Students(
StudentID INT PRIMARY KEY,
FirstName VARCHAR(50)
LastName VARCHAR(50)
FirstName VARCHAR(50)

)

INSERT INTO students(StudentID, FirstName, LastName)
VALUES(7000, “Arslan”, “Ahmad”);

// to see and view data: asterisk(*) for all
SELECT* FROM Students;
// update data
WHERE “FirstName” = ‘Rizwan’;
Database Management
DBmaker.java
Creates database
DBManager.java
Manages Database in adding, removing,
DAO Folder
So that you can manage each table/class modularly (module by module)
ClassDAO.java
…

Current SQL used in SQLite
CREATE TABLE "Class" (
    "ClassID"    INTEGER,
    "ClassName"    TEXT,
    PRIMARY KEY("ClassID" AUTOINCREMENT)
);
CREATE TABLE "Student" (
    "StudentID"    INTEGER,
    "StudentName"    TEXT,
    "ClassID"    INTEGER,
    FOREIGN KEY("ClassID") REFERENCES "Class"("ClassID") ON DELETE CASCADE,
    PRIMARY KEY("StudentID" AUTOINCREMENT)
);
CREATE TABLE "Subjects" (
    "SubjectID"    INTEGER,
    "SubjectName"    TEXT,
    "ClassID"    INTEGER,
    FOREIGN KEY("ClassID") REFERENCES "Class"("ClassID") ON DELETE CASCADE,
    PRIMARY KEY("SubjectID" AUTOINCREMENT)
);
CREATE TABLE "Teacher" (
    "TeacherID"    INTEGER,
    "TeacherName"    TEXT,
    "SubjectID"    INTEGER,
    FOREIGN KEY("SubjectID") REFERENCES "Subjects"("SubjectID") ON DELETE CASCADE,
    PRIMARY KEY("TeacherID" AUTOINCREMENT)
);
CREATE TABLE "Grade" (
    "GradeID"      INTEGER PRIMARY KEY AUTOINCREMENT,
    "StudentID"    INTEGER,
    "SubjectID"    INTEGER,
    "ObtainedMarks" INTEGER,
    FOREIGN KEY("StudentID") REFERENCES "Student"("StudentID") ON DELETE CASCADE,
    FOREIGN KEY("SubjectID") REFERENCES "Subjects"("SubjectID") ON DELETE CASCADE
);
```
---
Inserting Dummy Values (Testing)
```
INSERT INTO Class (ClassID, ClassName) VALUES (1,'Class 1');
INSERT INTO Class (ClassID, ClassName) VALUES (2,'Class 2');
INSERT INTO Class (ClassID, ClassName) VALUES (3,'Class 3');
INSERT INTO Student (StudentID, StudentName, ClassID) VALUES (1,'Sara Ahmed',1);
INSERT INTO Student (StudentID, StudentName, ClassID) VALUES (2,'Ali Khan',2);
INSERT INTO Student (StudentID, StudentName, ClassID) VALUES (3,'Hina Malik',1);
INSERT INTO Student (StudentID, StudentName, ClassID) VALUES (4,'Ahmed Raza',2);
INSERT INTO Student (StudentID, StudentName, ClassID) VALUES (5,'Fatima Noor',3);
INSERT INTO Student (StudentID, StudentName, ClassID) VALUES (6,'Bilal Hussain',3);
INSERT INTO Subjects (SubjectID, SubjectName, ClassID) VALUES (1,'Mathematics',1);
INSERT INTO Subjects (SubjectID, SubjectName, ClassID) VALUES (2,'Science',1);
INSERT INTO Subjects (SubjectID, SubjectName, ClassID) VALUES (3,'English',2);
INSERT INTO Subjects (SubjectID, SubjectName, ClassID) VALUES (4,'History',2);
INSERT INTO Subjects (SubjectID, SubjectName, ClassID) VALUES (5,'Physics',3);
INSERT INTO Subjects (SubjectID, SubjectName, ClassID) VALUES (6,'Chemistry',3);
INSERT INTO Teacher (TeacherID, TeacherName, SubjectID) VALUES (1,'Mr. Aslam',1);
INSERT INTO Teacher (TeacherID, TeacherName, SubjectID) VALUES (2,'Ms. Farah',2);
INSERT INTO Teacher (TeacherID, TeacherName, SubjectID) VALUES (3,'Mr. Kamran',3);
INSERT INTO Teacher (TeacherID, TeacherName, SubjectID) VALUES (4,'Mrs. Sana',4);
INSERT INTO Teacher (TeacherID, TeacherName, SubjectID) VALUES (5,'Dr. Imran',5);
INSERT INTO Teacher (TeacherID, TeacherName, SubjectID) VALUES (6,'Prof. Nadia',6);
Automatically Generated by SQLite
CREATE TABLE sqlite_sequence(name,seq);
INSERT INTO sqlite_sequence (name,seq) VALUES ('Class',3);
INSERT INTO sqlite_sequence (name,seq) VALUES ('Student',6);
INSERT INTO sqlite_sequence (name,seq) VALUES ('Subjects',6);
INSERT INTO sqlite_sequence (name,seq) VALUES ('Teacher',6);
```
---
Updating Values in a Column of a Table
```
UPDATE Subjects SET ObtainedMarks = 95 WHERE SubjectID = 1;
UPDATE Subjects SET ObtainedMarks = 88 WHERE SubjectID = 2;
UPDATE Subjects SET ObtainedMarks = 70 WHERE SubjectID = 3;
UPDATE Subjects SET ObtainedMarks = 40 WHERE SubjectID = 4;
UPDATE Subjects SET ObtainedMarks = 71 WHERE SubjectID = 5;
UPDATE Subjects SET ObtainedMarks = 65 WHERE SubjectID = 6;
```
---
**Grade Table**
```
CREATE TABLE "Grade" (
	"GradeID"	INTEGER,
	"StudentID"	INTEGER,
	"SubjectID"	INTEGER,
	"ObtainedMarks" INTEGER,
	FOREIGN KEY("StudentID") REFERENCES "Student"("StudentID") ON DELETE CASCADE,
	FOREIGN KEY("SubjectID") REFERENCES "Subjects"("SubjectID") ON DELETE CASCADE,
	PRIMARY KEY("GradeID" AUTOINCREMENT)
);
```

##### Printing All Classes students with SubjectName with Grades 


```
SELECT s.StudentName, subj.SubjectName, subj.Marks,  g.ObtainedMarks, c.ClassName
FROM Grade g
JOIN Student s ON g.StudentID = s.StudentID
JOIN Subjects subj ON g.SubjectID = subj.SubjectID
JOIN Class c ON s.ClassID = c.ClassID;
```
---




#### Seeing All Subjects of Student with grades
```
SELECT s.StudentName, 
       subj.SubjectName, 
       subj.Marks AS TotalMarks,  
       g.ObtainedMarks
FROM Grade g
JOIN Student s ON g.StudentID = s.StudentID
JOIN Subjects subj ON g.SubjectID = subj.SubjectID
WHERE s.StudentName = 'Ali Khan';
```




##### Get Students with Grades of a Class

```
SELECT s.StudentName, 
       subj.SubjectName, 
       subj.Marks AS TotalMarks,  
       g.ObtainedMarks
FROM Grade g
JOIN Student s ON g.StudentID = s.StudentID
JOIN Subjects subj ON g.SubjectID = subj.SubjectID
JOIN Class c ON s.ClassID = c.ClassID
WHERE c.ClassName = 'Class 1';
```



# Triggers


View Queries:

First Version:
```
CREATE VIEW GradeView AS
SELECT
    g.SubjectID,                     -- subject reference
    g.ObtainedMarks,
    s.Marks AS TotalMarks
    (g.ObtainedMarks *100.0 / s.Marks) AS Percentage,   -- calculation
    CASE  --Conditional Character assigned
        WHEN (g.ObtainedMarks* 100.0 / s.Marks) >= 90 THEN 'A'
        WHEN (g.ObtainedMarks *100.0 / s.Marks) >= 80 THEN 'B'
        WHEN (g.ObtainedMarks* 100.0 / s.Marks) >= 70 THEN 'C'
        WHEN (g.ObtainedMarks * 100.0 / s.Marks) >= 60 THEN 'D'
        ELSE 'F'
    END AS Grade
FROM Grade g --- naming this table Grade
JOIN Subjects s ON g.SubjectID = s.SubjectID; --Joinining Based on similar subjectID
```
Improved Version: (Finalized and currently used) - Customized to my DB
```
CREATE VIEW getGrades AS
SELECT
  s.StudentName,
  sub.SubjectName,
  sub.Marks,
  g.ObtainedMarks,
  ((g.ObtainedMarks * 100) / sub.Marks) || '%'  AS Percentage,
  CASE 
  WHEN ((g.ObtainedMarks * 100) / sub.Marks) >= 90 THEN 'A'
  WHEN ((g.ObtainedMarks * 100) / sub.Marks) >= 80 THEN 'B'
  WHEN ((g.ObtainedMarks * 100) / sub.Marks) >= 60 THEN 'C'
  WHEN ((g.ObtainedMarks * 100) / sub.Marks) >= 50 THEN 'D'
  ELSE 'F'
  END AS Grade,
  c.ClassName
FROM Grade g
  JOIN Student s ON s.StudentID = g.StudentID
  JOIN Subjects sub ON sub.SubjectID = g.SubjectID
    JOIN Class c ON s.ClassID = c.ClassID
```
To call this simply type,
`SELECT *FROM viewName;`
i.e.,
`SELECT* FROM GradesView;`



**Trigger-used**
```
CREATE TRIGGER CheckStudentClass
BEFORE INSERT ON Grade
FOR EACH ROW
BEGIN

-- if & ONLY if students class matches the subject class, continue

    SELECT
        CASE
            WHEN (SELECT ClassID FROM Student WHERE StudentID = NEW.StudentID)
               != (SELECT ClassID FROM Subjects WHERE SubjectID = NEW.SubjectID)
            THEN RAISE(ABORT, 'MISMATCH: Subject is not in the Student Class.')
        END;
END;
```

**Query to not let obtained marks be greater than TotalMarks**
```
CREATE TRIGGER CheckObtainedMarks
BEFORE INSERT ON Grade
FOR EACH ROW
BEGIN
    SELECT
        CASE
            WHEN NEW.ObtainedMarks > (SELECT Marks FROM Subjects WHERE SubjectID = NEW.SubjectID)
            THEN RAISE(ABORT, 'Obtained marks cannot be greater than total marks of the subject.')
        END;
END
```